<script lang="ts">
	import * as Select from '$lib/components/ui/select';
	import { cn } from '$lib/utils.js';
	import { Typography } from '$lib/components/ui/typography';
	import type { Team } from '$lib/supabase';
	import { Icon } from '$lib/icons';
	import { page } from '$app/stores';

	export let isCollapsed: boolean;
	export let teams: Team[];

	console.log(JSON.stringify(teams));

	let selectedTeam = teams[0];

	$: if (typeof document !== 'undefined') {
		document.cookie = 'team=' + selectedTeam.id;
	}
</script>

{#if selectedTeam}
	<Select.Root
		portal={null}
		selected={{ value: selectedTeam.name, label: selectedTeam.name }}
		onSelectedChange={(e) => {
			selectedTeam = teams.find((team) => team.name === e?.value) || teams[0];
		}}
	>
		<Select.Trigger
			class={cn(
				'flex items-center gap-2 [&>span]:line-clamp-1 [&>span]:flex [&>span]:w-full [&>span]:items-center [&>span]:gap-1 [&>span]:truncate [&_svg]:h-4 [&_svg]:w-4 [&_svg]:shrink-0',
				isCollapsed &&
					'flex h-9 w-9 shrink-0 items-center justify-start p-0 [&>div>svg]:hidden [&>span]:w-auto'
			)}
			aria-label="Select team"
		>
			<span class="pointer-events-none">
				<Icon src={selectedTeam.icon_url} class={'size-6 min-h-6 min-w-6'} />
				<span class={cn(isCollapsed ? '!ml-0 !hidden' : 'ml-2')}>
					<Typography variant="title-sm">{selectedTeam.name}</Typography>
				</span>
			</span>
		</Select.Trigger>
		<Select.Content sameWidth={!isCollapsed} align={isCollapsed ? 'center' : undefined}>
			<Select.Group>
				{#each teams as team}
					<Select.Item value={team.name} label={team.name}>
						<div
							class="flex items-center justify-start gap-3 [&_svg]:h-4 [&_svg]:w-4 [&_svg]:shrink-0 [&_svg]:text-foreground"
						>
							<Icon
								src={team.icon_url}
								aria-hidden="true"
								class="size-6 min-h-6 min-w-6 text-foreground"
							/>
							<Typography variant="title-sm">{team.name}</Typography>
						</div>
					</Select.Item>
				{/each}
			</Select.Group>
		</Select.Content>
		<Select.Input hidden name="team" />
	</Select.Root>
{:else}
	<p>No teams found</p>
{/if}
